@model CvProjekt.Models.User

@{
    ViewData["Title"] = "Min Profil";
}
<div class="container mt-3 mb-3 p-3 bg-light border rounded text-center" style="max-width: 250px;">
    <h5 class="mb-2">游늵 Statistik</h5>
    <p class="mb-0">
        Profilbes칬k:
        <strong>@Model.ProfileVisits</strong>
    </p>
</div>


<div class="container bg-light p-5">
    <div class="position-relative d-flex justify-content-center align-items-center mb-4">

        <h1 class="m-0">Min Profil</h1>

        <div class="position-absolute end-0">
            <a asp-controller="Profile" asp-action="Settings" class="btn btn-primary">Inst칛llningar</a>
        </div>

    </div>
@if (Model != null)
{
        <h4 class="text-center" style="margin: 2rem auto;">V칛lkommen @Model.FirstName @Model.LastName</h4>

        <div class="container mb-3 p-5">
            <div class="container mt-3 mb-3 p-5 bg-white shadow-sm">
                @if (Model.ImgUrl != null)
                {
                    <div class="ratio ratio-1x1 rounded-circle overflow-hidden" style="width: 25%; margin: 2rem 1rem;">
                        <img src="@Model.ImgUrl" alt="Profilbild" class="img-fluid object-fit-cover">
                    </div>
                }

                <div class="container mt-3 mb-3">
                    <h3 class="mb-3">@Model.FirstName @Model.LastName</h3>
                    <h4>Kontakt:</h4>
                    <h6>@Model.Email</h6>
                    <h6>@Model.Adress</h6>
                </div>

                <div class="container">

                    <h4>Mina kompetenser:</h4>
                    @if (Model.Resume != null && Model.Resume.Qualifications != null)
                    {
                        <ul class="list-inline">

                            @foreach (var q in Model.Resume.Qualifications)
                            {
                                <li class="list-inline-item border border-info p-1 mb-2">@q.Name</li>
                            }
                        </ul>
                    }
                </div>

                <div class="container">
                    <h4>Utbildning:</h4>
                    @if (Model.Resume != null && Model.Resume.EducationList != null)
                    {
                        <ul class="list-unstyled">
                            @foreach (var e in Model.Resume.EducationList)
                            {
                                <div class="d-flex flex-row justify-content-start">
                                    <li>@e.SchoolName -&#160;</li>
                                    <li>@e.DegreeName &#160;</li>
                                    <li>&#40;@e.StartYear -&#160;</li>
                                    @if (e.EndYear != null)
                                    {
                                        <li>@e.EndYear&#41;</li>
                                    }
                                    else
                                    {
                                        <li>Nu&#41;</li>
                                    }
                                </div>
                                <li>@e.Description</li>

                            }
                        </ul>
                    }

                </div>

                <div class="container">
                    <h4>Arbetslivserfarenhet:</h4>
                    @if (Model.Resume != null && Model.Resume.WorkList != null)
                    {
                        <ul class="list-unstyled">
                            @foreach (var w in Model.Resume.WorkList)
                            {
                                <div class="d-flex flex-row justify-content-start">
                                    <li>@w.CompanyName -&#160;</li>
                                    <li>@w.Position &#160;</li>
                                    <li>&#40;@w.StartDate.ToString("yyyy/MM/dd") -&#160;</li>
                                    @if (w.EndDate != null)
                                    {
                                        <li>@w.EndDate?.ToString("yyyy/MM/dd")&#41;</li>
                                    }
                                    else
                                    {
                                        <li>Nu&#41;</li>
                                    }
                                </div>
                                <li>@w.Description</li>

                            }
                        </ul>
                    }
                </div>
                <div class="d-flex flex-row justify-content-center">
                    <a asp-controller="Profile" asp-action="EditResume" class="btn btn-primary">Redigera CV</a>
                </div>
            </div>
            <div class="container mt-5 mb-3 mr-2 ml-2">
                <h2 class="text-center">Dina skapade projekt:</h2>
                @if (Model.Projects != null && Model.Projects.Count > 0)
                {

                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        <div class="col">
                            <div class="card h-100 border-info p-2 shadow-sm">
                                @foreach (var p in Model.Projects)
                                {
                                    <div class="card-body">
                                        <div class="d-flex flex-row justify-content-center align-items-center">
                                            <h5 class="card-title fw-bold text-info">@p.Title &#160</h5>
                                            <h6>&#40;@p.Year&#41;</h6>
                                        </div>
                                        <p>Spr친k: @p.Language</p>
                                        @if (p.Description != null)
                                        {
                                            <p>Beskrivning: @p.Description</p>
                                        }
                                        @if (p.ProjectMembers != null)
                                        {
                                            foreach (var pm in p.ProjectMembers)
                                            {
                                                var members = p.ProjectMembers
                                                .Where(pm => pm.MProjectId == p.Id)
                                                .Select(pm => pm.user)
                                                .Where(u => u != null && u.Id != p.CreatorId && u.IsActive == true)
                                                .Distinct()
                                                .ToList();
                                                foreach (var mem in members)
                                                {
                                                    <p>Deltagare</p>
                                                    <span class="small text-dark">@mem.FirstName @mem.LastName</span>
                                                }
                                            }
                                        }
                                        @if (p.GithubLink != null)
                                        {
                                            <a href="@p.GithubLink">Visa p친 Github</a>
                                        }
                                    </div>
                                }
                            </div>

                        </div>
                    </div>
                }
                else
                {
                    <div class="d-flex flex-column justify-content-center">
                        <h4>Inga projekt tillagda</h4>
                    </div>
                }
                <div class="d-flex flex-row justify-content-center mt-4">
                    <a asp-controller="Profile" asp-action="EditProjects" class="btn btn-primary">Redigera Projekt</a>
                </div>
            </div>
        </div>
}
else
{
        <h4>Ingen information hittad</h4>
}
    <div class="container mt-5 mb-3 mr-2 ml-2">
        <h2 class="text-center">Projekt du deltar i</h2>
        @{
            var memberProjects = (List<CvProjekt.Models.Project>?)ViewBag.MemberProjects ?? new
            List<CvProjekt.Models.Project>();

        }

        @if (memberProjects.Any())
        {
            <div class="row row-cols-1 row-cols-md-2 g-4">
                @foreach (var project in memberProjects)
                {
                    <div class="col">
                        <div class="card h-100 border-success p-2 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title fw-bold text-success">@project.Title (@project.Year)</h5>
                                <p class="small text-muted">Av: @project.Creator.FirstName @project.Creator.LastName</p>
                                <p>Spr친k: @project.Language</p>
                                @if (project.Description != null)
                                {
                                    <p>Beskrivning: @project.Description</p>
                                }
                                @{
                                    var participants = project.ProjectMembers
                                    .Where(pm => pm.user != null && pm.MemberId != project.CreatorId)
                                    .Select(pm => pm.user)
                                    .Distinct()
                                    .ToList();
                                }
                                @if (participants.Any())
                                {
                                    <h6 class="mt-3 small text-muted">Deltagare</h6>
                                    <ul class="list-unstyled">
                                        @foreach (var mem in participants)
                                        {
                                            <li class="small text-dark">@mem.FirstName @mem.LastName</li>
                                        }
                                    </ul>
                                }
                                @if (project.GithubLink != null)
                                {
                                    <a href="@project.GithubLink" target="_blank">Visa p친 Github</a>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-muted text-center">Du deltar inte i n친gra projekt 칛nnu.</p>
        }
    </div>