@model CvProjekt.Models.User

@{
    ViewData["Title"] = "Extern Profil";
}

<div class="container bg-light p-4">
    @if (Model == null)
    {
        <div class="alert alert-warning">Ingen användare att visa.</div>
    }
    else
    {
        <h2 class="text-center mb-4">Profil för @Model.FirstName @Model.LastName</h2>

        <div class="row mb-4">
            <div class="col-md-3 text-center">
                @if (!string.IsNullOrEmpty(Model.ImgUrl))
                {
                    <img src="@Model.ImgUrl" alt="Profilbild" class="img-fluid rounded-circle" style="width:200px;height:200px;object-fit:cover;" />
                }
                else
                {
                    <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center" style="width:200px;height:200px;">
                        <span>@Model.FirstName?.Substring(0,1)@Model.LastName?.Substring(0,1)</span>
                    </div>
                    <a asp-controller="Message"
                       asp-action="SendMessages"
                       asp-route-receiverId="@Model.Id"
                       class="btn btn-primary">
                        Skicka meddelande
                    </a>
                }
                <p class="mt-2"><strong>@Model.FirstName @Model.LastName</strong></p>
                <p>@Model.Email</p>
                <p>@Model.Adress</p>
                <p class="text-muted">Besök: @Model.ProfileVisits</p>
            </div>

            <div class="col-md-9">
                <div class="mb-3">
                    <h4>Kompetenser</h4>
                    @if (Model.Resume?.Qualifications != null && Model.Resume.Qualifications.Any())
                    {
                        <ul class="list-inline">
                            @foreach (var q in Model.Resume.Qualifications)
                            {
                                <li class="list-inline-item badge bg-info text-dark me-1 p-2">@q.Name</li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p><em>Inga kompetenser angivna.</em></p>
                    }
                </div>

                <div class="mb-3">
                    <h4>Utbildning</h4>
                    @if (Model.Resume?.EducationList != null && Model.Resume.EducationList.Any())
                    {
                        <ul class="list-unstyled">
                            @foreach (var e in Model.Resume.EducationList)
                            {
                                <li class="mb-2">
                                    <strong>@e.SchoolName</strong> — @e.DegreeName
                                    <div class="text-muted">
                                        (@e.StartYear - @(e.EndYear != null ? e.EndYear.ToString() : "Nu"))
                                    </div>
                                    @if (!string.IsNullOrEmpty(e.Description))
                                    {
                                        <div>@e.Description</div>
                                    }
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p><em>Ingen utbildning angiven.</em></p>
                    }
                </div>

                <div class="mb-3">
                    <h4>Arbetslivserfarenhet</h4>
                    @if (Model.Resume?.WorkList != null && Model.Resume.WorkList.Any())
                    {
                        <ul class="list-unstyled">
                            @foreach (var w in Model.Resume.WorkList)
                            {
                                <li class="mb-2">
                                    <strong>@w.Position</strong> — @w.CompanyName
                                    <div class="text-muted">
                                        @(
                                            w.StartDate != null
                                            ? (w.StartDate is System.DateOnly sd ? sd.Year.ToString() : w.StartDate.ToString())
                                            : ""
                                        )
                                        -
                                        @(
                                            w.EndDate != null
                                            ? (w.EndDate is System.DateOnly ed ? ed.Year.ToString() : w.EndDate.ToString())
                                            : "Nu"
                                        )
                                    </div>
                                    @if (!string.IsNullOrEmpty(w.Description))
                                    {
                                        <div>@w.Description</div>
                                    }
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p><em>Ingen arbetslivserfarenhet angiven.</em></p>
                    }
                </div>
            </div>
        </div>

        <hr />

        <div class="mb-4">
            <h3>Projekt</h3>
            @if (Model.Projects != null && Model.Projects.Any())
            {
                <div class="row">
                    @foreach (var p in Model.Projects)
                    {
                        <div class="col-md-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">@p.Title (@p.Year)</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">@p.Language</h6>
                                    <p class="card-text">@p.Description</p>
                                    @if (!string.IsNullOrEmpty(p.GithubLink))
                                    {
                                        var link = p.GithubLink.StartsWith("http", System.StringComparison.OrdinalIgnoreCase) ? p.GithubLink : "https://" + p.GithubLink;
                                        <a href="@link" target="_blank" class="card-link">GitHub</a>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p><em>Inga projekt publicerade.</em></p>
            }
        </div>

        <hr />

        <div class="mb-4">
            <h3>Kontakta @Model.FirstName</h3>

            <form asp-controller="Message" asp-action="SendMessage" method="post" class="row g-3">
                @Html.AntiForgeryToken()
                <input type="hidden" name="ToUserId" value="@Model.Id" />

                @if (!User.Identity.IsAuthenticated)
                {
                    <div class="col-md-6">
                        <label for="SenderName" class="form-label">Ditt namn</label>
                        <input type="text" name="SenderName" class="form-control" id="SenderName" placeholder="Ditt namn" />
                    </div>
                }

                <div class="col-12">
                    <label for="Text" class="form-label">Meddelande</label>
                    <textarea name="Text" class="form-control" id="Text" rows="5" placeholder="Skriv ditt meddelande här..." required></textarea>
                </div>

                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Skicka meddelande</button>
                </div>
            </form>
        </div>
    }
</div>
